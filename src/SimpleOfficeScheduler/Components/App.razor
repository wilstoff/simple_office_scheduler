@inject IHttpContextAccessor HttpContextAccessor

@{
    var themePreference = HttpContextAccessor.HttpContext?.User?.FindFirst("ThemePreference")?.Value;
    var isLight = themePreference == "light";
}

<!DOCTYPE html>
<html lang="en" @(isLight ? "data-theme=\"light\"" : "")>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <base href="/" />
    <script>
        (function() {
            // Server rendered the data-theme attribute from DB.
            // Sync localStorage to match.
            var serverTheme = document.documentElement.getAttribute('data-theme');
            if (serverTheme === 'light') {
                localStorage.setItem('theme', 'light');
            } else {
                // Check localStorage as fallback (for anonymous/pre-login)
                var t = localStorage.getItem('theme');
                if (t === 'light') document.documentElement.setAttribute('data-theme', 'light');
            }
        })();
        window.setTheme = function(theme) {
            if (theme === 'light') {
                document.documentElement.setAttribute('data-theme', 'light');
            } else {
                document.documentElement.removeAttribute('data-theme');
            }
            localStorage.setItem('theme', theme);
            // Persist to DB (best-effort)
            fetch('/api/user/settings/theme', {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ theme: theme })
            }).catch(function() {});
        };
        window.toggleTheme = function() {
            var isLight = document.documentElement.getAttribute('data-theme') === 'light';
            window.setTheme(isLight ? 'dark' : 'light');
            var d = document.querySelector('.theme-icon-dark');
            var l = document.querySelector('.theme-icon-light');
            if (d) d.style.display = isLight ? 'inline' : 'none';
            if (l) l.style.display = isLight ? 'none' : 'inline';
        };
        document.addEventListener('DOMContentLoaded', function() {
            var isLight = document.documentElement.getAttribute('data-theme') === 'light';
            var d = document.querySelector('.theme-icon-dark');
            var l = document.querySelector('.theme-icon-light');
            if (d) d.style.display = isLight ? 'none' : 'inline';
            if (l) l.style.display = isLight ? 'inline' : 'none';
        });
    </script>
    <link rel="stylesheet" href="bootstrap/bootstrap.min.css" />
    <link rel="stylesheet" href="app.css?v=4" />
    <link rel="stylesheet" href="SimpleOfficeScheduler.styles.css?v=4" />
    <link rel="icon" type="image/png" href="favicon.png" />
    <HeadOutlet />
</head>

<body>
    <Routes />
    <script src="_framework/blazor.web.js"></script>
</body>

</html>
